<html>
<head>
    <meta charset="UTF-8">
    <title>Idea Bank</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pretty-checkbox@3.0/dist/pretty-checkbox.min.css" />
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <link type="text/css" rel="stylesheet" href="assets/css/we-idea-bank.css" />
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <div class="container">
                <div class="row">
                    <div class="col-9 mx-auto">
                        <div class="row">
                            <div class="card ib-login-card">
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-6 d-flex justify-content-center flex-column">
                                            <div class="login-page-left-side">
                                                <img src="/assets/img/login-img.png" class="img-fluid" alt="login Form Image" />
                                            </div>
                                        </div>
                                        <div class="col-6 d-flex justify-content-center flex-column">
                                            <div id="loginForm" class="form-container">
                                                <form id="login_form">
                                                    <div class="form ib-login-container">
                                                        <div class="form-group">
                                                            <h4>Login</h4>
                                                            <p>Perform and manage your assignments to become faster.</p>
                                                        </div>
                                                        <div class="form-group">
                                                            <label>Username</label>
                                                            <input class="form-control" type="text" id="username" name="username" placeholder="Username" />
                                                            <p class="err-text text-danger" id="username_err"></p>
                                                            <input type="hidden" value="0" id="check_invalid"/>
                                                        </div>
                                                        <div class="form-group">
                                                            <label>Password</label>
                                                            <input class="form-control" type="password" id="password" name="password" placeholder="Password" required/>
                                                            <p class="err-text text-danger" id="password_err"></p>
                                                        </div>
                                                        <div class="form-group">
                                                            <button class="btn btn-primary w-100" type="submit" name="submit">Go Inside</button>
                                                            <p class="err-text text-danger" id="general_err"></p>
                                                        </div>
                                                        <div class="form-group">
                                                            <span id="forgotBtn" class="lfp-btn">Forgot Password?</span>
                                                        </div>
                                                    </div>
                                                </form>
                                            </div>
                                            <div id="forgotForm"  class="form-container" style="display: none;">
                                                <form>
                                                    <div class="form ib-login-container">
                                                        <div class="form-group">
                                                            <h4>Forgot Password</h4>
                                                            <p>Recover your password by your registered email.</p>
                                                        </div>
                                                        <div class="form-group">
                                                            <label>Username or Email</label>
                                                            <input class="form-control" type="text" id="" name="username" placeholder="Username or Email" />
                                                            <p class="err-text text-danger"></p>
                                                        </div>
                                                        <div class="form-group">
                                                            <button class="btn btn-primary w-100" type="submit" name="submit">Submit</button>
                                                        </div>
                                                        <div class="form-group">
                                                            <span id="loginBtn" class="lfp-btn">Back to Login</span>
                                                        </div>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/assets/js/ajaxCall.js"></script>
    <script>
        $(document).on("click", ".lfp-btn", function(){
            var id = $(this).attr("id");
            if(id === "loginBtn"){
                $(".form-container").hide();
                $("#loginForm").show();
            }
            if(id === "forgotBtn"){
                $(".form-container").hide();
                $("#forgotForm").show();
            }
        });

        $("#username").keyup(async function(){
            const name = $("#username").val();

            if(name == ''){
                $("#check_invalid").val(0)
                return $("#username_err").html('');
            }
            const method = "POST";
            const data = {username : name};
            const url = "/auth/check-name";

            console.log(data);

            const call = await ajaxCall(url, data, method);
            if(call.status == 2){
                $("#check_invalid").val(1)
                $("#username_err").html(call.message);
            }
            else{
                $("#check_invalid").val(0)
                $("#username_err").html('');
            }
        });

        const chatForm = document.getElementById('login_form');
        chatForm.addEventListener('submit', e => {
            e.preventDefault();
            const name = $("#username").val();
            const password = $("#password").val();
            const valid = $("#check_invalid").val();
            if(valid == 1){
                return $("#username_err").html('Invalid Username, Kindly Enter Correct Username');
            }
            $("#username_err").html('');
            $("#password_err").html('');
            fetch("/auth/login", {
                method: "POST",
                body: JSON.stringify({username : name, password: password}),
                headers: {
                    "Content-Type": "application/json",
                },
                credentials: "same-origin",
            })
            .then((res) => res.json())
            .then((data) => { 
                const status = data.status;
               
                switch (status) {
                    case 1:
                        return window.location.replace(data.redirect_url);
                        break;
                    case 2:
                        return $("#password_err").html(data.message);
                        break;
                    default:
                        return $("#general_err").html(data.message)
                        break;
                }
            });
        });
    </script>
</body>
</html>